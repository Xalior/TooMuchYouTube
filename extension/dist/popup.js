(()=>{var J=["youtu.be","youtube-nocookie.com","youtube.ae","youtube.al","youtube.am","youtube.at","youtube.az","youtube.ba","youtube.be","youtube.bg","youtube.bh","youtube.bo","youtube.by","youtube.ca","youtube.cat","youtube.ch","youtube.cl","youtube.co","youtube.co.ae","youtube.co.at","youtube.co.cr","youtube.co.hu","youtube.co.id","youtube.co.il","youtube.co.in","youtube.co.jp","youtube.co.ke","youtube.co.kr","youtube.co.ma","youtube.co.nz","youtube.co.th","youtube.co.tz","youtube.co.ug","youtube.co.uk","youtube.co.ve","youtube.co.za","youtube.co.zw","youtube.com","youtube.com.ar","youtube.com.au","youtube.com.az","youtube.com.bd","youtube.com.bh","youtube.com.bo","youtube.com.br","youtube.com.by","youtube.com.co","youtube.com.do","youtube.com.ec","youtube.com.ee","youtube.com.eg","youtube.com.es","youtube.com.gh","youtube.com.gr","youtube.com.gt","youtube.com.hk","youtube.com.hn","youtube.com.hr","youtube.com.jm","youtube.com.jo","youtube.com.kw","youtube.com.lb","youtube.com.lv","youtube.com.ly","youtube.com.mk","youtube.com.mt","youtube.com.mx","youtube.com.my","youtube.com.ng","youtube.com.ni","youtube.com.om","youtube.com.pa","youtube.com.pe","youtube.com.ph","youtube.com.pk","youtube.com.pt","youtube.com.py","youtube.com.qa","youtube.com.ro","youtube.com.sa","youtube.com.sg","youtube.com.sv","youtube.com.tn","youtube.com.tr","youtube.com.tw","youtube.com.ua","youtube.com.uy","youtube.com.ve","youtube.cr","youtube.cz","youtube.de","youtube.dk","youtube.ee","youtube.es","youtube.fi","youtube.fr","youtube.ge","youtube.gr","youtube.gt","youtube.hk","youtube.hr","youtube.hu","youtube.ie","youtube.in","youtube.iq","youtube.is","youtube.it","youtube.jo","youtube.jp","youtube.kr","youtube.kz","youtube.la","youtube.lk","youtube.lt","youtube.lu","youtube.lv","youtube.ly","youtube.ma","youtube.md","youtube.me","youtube.mk","youtube.mn","youtube.mx","youtube.my","youtube.ng","youtube.ni","youtube.nl","youtube.no","youtube.pa","youtube.pe","youtube.ph","youtube.pk","youtube.pl","youtube.pr","youtube.pt","youtube.qa","youtube.ro","youtube.rs","youtube.ru","youtube.sa","youtube.se","youtube.sg","youtube.si","youtube.sk","youtube.sn","youtube.soy","youtube.sv","youtube.tn","youtube.tv","youtube.ua","youtube.ug","youtube.uy","youtube.vn","youtubeeducation.com","youtubefanfest.com","youtubegaming.com","youtubego.co.id","youtubego.co.in","youtubego.com","youtubego.com.br","youtubego.id","youtubego.in","youtubekids.com","youtubemobilesupport.com","yt.be"],fe=new Set(J);function Z(C){let v=C.toLowerCase();if(fe.has(v))return!0;for(let c of J)if(v.endsWith(`.${c}`))return!0;return!1}var a=document.getElementById("rulesBody"),y=document.getElementById("status"),ee=document.getElementById("addRule"),B=document.getElementById("quickAddChannel"),D=document.getElementById("quickAddVideo"),H=document.getElementById("newType"),L=document.getElementById("newValue"),p=document.getElementById("newSpeed"),k=document.getElementById("debugInfo"),te=document.getElementById("aboutOpen"),oe=document.getElementById("aboutOpenBottom"),_=document.getElementById("appLogo"),ue=document.getElementById("aboutPanel"),ne=document.getElementById("aboutBuildMode"),Y=document.getElementById("editor"),j=document.getElementById("notYoutube");if(!a||!y||!ee||!B||!D||!H||!L||!p||!k||!te||!oe||!_||!ue||!ne||!Y||!j)console.warn("TooMuchYouTube popup: missing required elements.");else{let I=function(e){if(!e)return!1;try{let t=new URL(e);return Z(t.hostname)}catch{return!1}},V=function(e){if(!e)return"";try{let t=new URL(e);if(t.hostname==="youtu.be")return t.pathname.split("/")[1]?.split(/[?&#/]/)[0]||"";let o=t.searchParams.get("v");return o||t.pathname.startsWith("/shorts/")&&t.pathname.split("/shorts/")[1].split(/[?&#/]/)[0]||""}catch{return""}},W=function(e){let t=e.map(n=>n.trim()).filter(Boolean),o=t.find(n=>n.startsWith("@"));if(o)return o;let u=t.find(n=>/^UC[\w-]{10,}$/.test(n));return u||t[0]||""},U=function(){return new Promise(e=>{chrome.tabs.query({active:!0,currentWindow:!0},t=>{e(t&&t[0]?t[0]:null)})})},R=function(e){return new Promise(t=>{chrome.tabs.sendMessage(e,{type:"getQuickAddData"},o=>{if(chrome.runtime.lastError){t(null);return}t(o||null)})})},G=function(e){Q=e,Y.classList.toggle("hidden",!e),j.classList.toggle("hidden",e),document.body.classList.toggle("not-youtube",!e)},q=function(e){document.body.classList.toggle("about-open",e),ue.classList.toggle("hidden",!e),e?(Y.classList.remove("hidden"),j.classList.add("hidden")):G(Q)},X=function(){chrome.tabs?.query&&chrome.tabs.query({active:!0,currentWindow:!0},e=>{let t=e&&e[0]?e[0]:null,o=t?.url||t?.pendingUrl||"";G(I(o))})},m=function(e,t="success"){y.textContent=e,y.classList.remove("success","error","warning"),e?y.classList.add("show",t):y.classList.remove("show"),e&&(x&&window.clearTimeout(x),x=window.setTimeout(()=>{y.textContent="",y.classList.remove("show")},1500))},le=function(){document.body.classList.toggle("is-debug",d),k.classList.toggle("hidden",!d);let e=document.querySelector(".bottom-bar");e instanceof HTMLElement&&e.classList.toggle("no-debug",!d),S?_.classList.toggle("debug-rotated",d):_.classList.remove("debug-rotated"),d?k.textContent="DEBUG a7f1da5.260214.111542":k.textContent=""},N=function(e,t){d=e,le(),t&&chrome.storage.local.set({[A]:d})},F=function(){if(!S){N(!0,!1);return}chrome.storage.local.get({[A]:!1},e=>{N(!!e[A],!1)})},ae=function(){ne.textContent="prod"},ce=function(e){let t=re(c);chrome.storage.sync.set({rules:t},()=>{c=t,f(),e&&m("Saved","success")})},w=function(e=!0){T&&window.clearTimeout(T),T=window.setTimeout(()=>{T=null,ce(e)},500)},f=function(){if(a.innerHTML="",c.length===0){let e=document.createElement("div");e.className="hint",e.textContent="No rules yet. Add one below.",a.appendChild(e);return}c.forEach((e,t)=>{let o=document.createElement("div");o.className="row",o.dataset.index=String(t);let u=document.createElement("div");u.className="order";let n=document.createElement("span");n.className="index",n.textContent=String(t+1);let s=document.createElement("button");s.type="button",s.className="icon-btn small drag-handle",s.textContent="\u2261",s.title="Drag to reorder",s.draggable=!1,u.append(n,s);let z=document.createElement("select");z.dataset.field="type",["channel","videoId","title"].forEach(P=>{let M=document.createElement("option");M.value=P,M.textContent=v[P],e.type===P&&(M.selected=!0),z.appendChild(M)});let h=document.createElement("input");h.type="text",h.value=e.value,h.placeholder="Match text",h.dataset.field="value";let b=document.createElement("input");b.type="number",b.min="0.25",b.max="4",b.step="0.25",b.value=e.speed,b.placeholder="1.5",b.dataset.field="speed";let O=document.createElement("div");O.className="actions-inline";let E=document.createElement("button");E.type="button",E.className="icon-btn danger",E.textContent="Delete",E.dataset.action="delete",O.append(E),o.append(u,z,h,b,O),a.appendChild(o)})},re=function(e){return e.map(t=>({id:t.id||crypto.randomUUID(),type:t.type,value:String(t.value||"").trim(),speed:String(t.speed||"").trim()})).filter(t=>t.value&&t.speed)},se=function(e,t){if(t<0||t>=c.length)return;let o=[...c],[u]=o.splice(e,1);o.splice(t,0,u),c=o,f(),w()},ie=function(e){c=c.filter((t,o)=>o!==e),f(),w(!1),m("Deleted","error")},de=function(e,t,o){c=c.map((u,n)=>n!==e?u:{...u,[t]:o}),w()},be=function(e){return e.closest(".drag-handle")?!1:!!e.closest("input, select, textarea, button")},me=function(e,t){g=Number(e.dataset.index),i=t,r=e,l=r.cloneNode(!0),l.classList.add("drag-placeholder"),l.removeAttribute("data-index"),l.setAttribute("aria-hidden","true"),r.style.display="none",a.insertBefore(l,r),document.body.classList.add("no-select")},ye=function(e,t){if(!l)return;let o=Array.from(a.querySelectorAll(".row")).filter(n=>n!==l&&n!==r);if(o.length===0){a.appendChild(l);return}let u=o.find(n=>{let s=n.getBoundingClientRect();return t<s.top+s.height/2});u?u.insertAdjacentElement("beforebegin",l):o[o.length-1].insertAdjacentElement("afterend",l)},pe=function(e){let t=a.getBoundingClientRect(),o=24,u=12;if(e<t.top+o){let n=Math.max(0,t.top+o-e);a.scrollTop-=Math.min(u,n);return}if(e>t.bottom-o){let n=Math.max(0,e-(t.bottom-o));a.scrollTop+=Math.min(u,n)}},ge=function(){if(g!==null){if(l){let e=Array.from(a.children),t=0;for(let o of e){if(o===l)break;o.classList.contains("row")&&o!==r&&o!==l&&(t+=1)}g!==t&&se(g,t)}K()}},K=function(){l&&l.parentElement&&l.parentElement.removeChild(l),r&&(r.style.display=""),g=null,l=null,r=null,i=null,document.body.classList.remove("no-select")},C={rules:[]},v={channel:"Channel",title:"Title",videoId:"Video ID"},c=[],g=null,l=null,r=null,i=null,T=null,x=null,Q=!0,d=!1,S=!0,A="debugEnabled";async function $(){let e=await U();if(!e||!I(e.url||e.pendingUrl||"")){B.disabled=!0,D.disabled=!0;return}let t=e.id?await R(e.id):null,o=t?.videoId||V(e.url||e.pendingUrl||""),u=W(t?.channelCandidates||[]);D.disabled=!o,B.disabled=!u}a.addEventListener("click",e=>{let t=e.target;if(!(t instanceof HTMLElement))return;let o=t.closest(".row");if(!(o instanceof HTMLElement))return;let u=Number(o.dataset.index);t.dataset.action==="delete"&&ie(u)}),a.addEventListener("pointerdown",e=>{if(e.button!==0)return;let t=e.target;if(!(t instanceof HTMLElement)||be(t))return;let o=t.closest(".row");o instanceof HTMLDivElement&&(me(o,e.pointerId),e.target.setPointerCapture(e.pointerId))}),a.addEventListener("pointermove",e=>{i===null||e.pointerId!==i||(pe(e.clientY),ye(e.clientX,e.clientY))}),a.addEventListener("pointerup",e=>{i===null||e.pointerId!==i||ge()}),a.addEventListener("pointercancel",e=>{i===null||e.pointerId!==i||K()}),a.addEventListener("input",e=>{let t=e.target;if(!(t instanceof HTMLInputElement||t instanceof HTMLSelectElement))return;let o=t.closest(".row");if(!(o instanceof HTMLElement))return;let u=Number(o.dataset.index),n=t.dataset.field;n&&de(u,n,t.value)}),ee.addEventListener("click",()=>{let e=L.value.trim(),t=p.value.trim();if(!e||!t){m("Add a match and speed","warning");return}c=[...c,{id:crypto.randomUUID(),type:H.value,value:e,speed:t}],L.value="",p.value="",f(),w()}),te.addEventListener("click",()=>{q(!document.body.classList.contains("about-open"))}),oe.addEventListener("click",()=>{q(!document.body.classList.contains("about-open"))}),_.addEventListener("click",e=>{S&&e.detail===3&&N(!d,!0)}),B.addEventListener("click",async()=>{let e=await U(),t=e?.url||e?.pendingUrl||"";if(!e||!I(t)){m("Open a YouTube tab","warning");return}let o=e.id?await R(e.id):null,u=W(o?.channelCandidates||[]);if(!u){m("Channel not found","error");return}H.value="channel",L.value=u,p.focus(),p.select()}),D.addEventListener("click",async()=>{let e=await U(),t=e?.url||e?.pendingUrl||"";if(!e||!I(t)){m("Open a YouTube tab","warning");return}let u=(e.id?await R(e.id):null)?.videoId||V(t);if(!u){m("Video ID not found","error");return}H.value="videoId",L.value=u,p.focus(),p.select()}),chrome.storage.sync.get(C,e=>{c=e.rules||[],f(),X(),$(),F(),ae(),q(!1)}),X(),$(),F()}})();
