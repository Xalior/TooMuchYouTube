(()=>{var j=["youtu.be","youtube-nocookie.com","youtube.ae","youtube.al","youtube.am","youtube.at","youtube.az","youtube.ba","youtube.be","youtube.bg","youtube.bh","youtube.bo","youtube.by","youtube.ca","youtube.cat","youtube.ch","youtube.cl","youtube.co","youtube.co.ae","youtube.co.at","youtube.co.cr","youtube.co.hu","youtube.co.id","youtube.co.il","youtube.co.in","youtube.co.jp","youtube.co.ke","youtube.co.kr","youtube.co.ma","youtube.co.nz","youtube.co.th","youtube.co.tz","youtube.co.ug","youtube.co.uk","youtube.co.ve","youtube.co.za","youtube.co.zw","youtube.com","youtube.com.ar","youtube.com.au","youtube.com.az","youtube.com.bd","youtube.com.bh","youtube.com.bo","youtube.com.br","youtube.com.by","youtube.com.co","youtube.com.do","youtube.com.ec","youtube.com.ee","youtube.com.eg","youtube.com.es","youtube.com.gh","youtube.com.gr","youtube.com.gt","youtube.com.hk","youtube.com.hn","youtube.com.hr","youtube.com.jm","youtube.com.jo","youtube.com.kw","youtube.com.lb","youtube.com.lv","youtube.com.ly","youtube.com.mk","youtube.com.mt","youtube.com.mx","youtube.com.my","youtube.com.ng","youtube.com.ni","youtube.com.om","youtube.com.pa","youtube.com.pe","youtube.com.ph","youtube.com.pk","youtube.com.pt","youtube.com.py","youtube.com.qa","youtube.com.ro","youtube.com.sa","youtube.com.sg","youtube.com.sv","youtube.com.tn","youtube.com.tr","youtube.com.tw","youtube.com.ua","youtube.com.uy","youtube.com.ve","youtube.cr","youtube.cz","youtube.de","youtube.dk","youtube.ee","youtube.es","youtube.fi","youtube.fr","youtube.ge","youtube.gr","youtube.gt","youtube.hk","youtube.hr","youtube.hu","youtube.ie","youtube.in","youtube.iq","youtube.is","youtube.it","youtube.jo","youtube.jp","youtube.kr","youtube.kz","youtube.la","youtube.lk","youtube.lt","youtube.lu","youtube.lv","youtube.ly","youtube.ma","youtube.md","youtube.me","youtube.mk","youtube.mn","youtube.mx","youtube.my","youtube.ng","youtube.ni","youtube.nl","youtube.no","youtube.pa","youtube.pe","youtube.ph","youtube.pk","youtube.pl","youtube.pr","youtube.pt","youtube.qa","youtube.ro","youtube.rs","youtube.ru","youtube.sa","youtube.se","youtube.sg","youtube.si","youtube.sk","youtube.sn","youtube.soy","youtube.sv","youtube.tn","youtube.tv","youtube.ua","youtube.ug","youtube.uy","youtube.vn","youtubeeducation.com","youtubefanfest.com","youtubegaming.com","youtubego.co.id","youtubego.co.in","youtubego.com","youtubego.com.br","youtubego.id","youtubego.in","youtubekids.com","youtubemobilesupport.com","yt.be"],ne=new Set(j);function P(H){let v=H.toLowerCase();if(ne.has(v))return!0;for(let a of j)if(v.endsWith(`.${a}`))return!0;return!1}var c=document.getElementById("rulesBody"),m=document.getElementById("status"),O=document.getElementById("addRule"),M=document.getElementById("quickAddChannel"),D=document.getElementById("quickAddVideo"),k=document.getElementById("newType"),E=document.getElementById("newValue"),y=document.getElementById("newSpeed"),U=document.getElementById("debugInfo"),Q=document.getElementById("editor"),V=document.getElementById("notYoutube");if(!c||!m||!O||!M||!D||!k||!E||!y||!U||!Q||!V)console.warn("TooMuchYouTube popup: missing required elements.");else{let T=function(e){if(!e)return!1;try{let t=new URL(e);return P(t.hostname)}catch{return!1}},_=function(e){if(!e)return"";try{let t=new URL(e);if(t.hostname==="youtu.be")return t.pathname.split("/")[1]?.split(/[?&#/]/)[0]||"";let u=t.searchParams.get("v");return u||t.pathname.startsWith("/shorts/")&&t.pathname.split("/shorts/")[1].split(/[?&#/]/)[0]||""}catch{return""}},q=function(e){let t=e.map(n=>n.trim()).filter(Boolean),u=t.find(n=>n.startsWith("@"));if(u)return u;let o=t.find(n=>/^UC[\w-]{10,}$/.test(n));return o||t[0]||""},C=function(){return new Promise(e=>{chrome.tabs.query({active:!0,currentWindow:!0},t=>{e(t&&t[0]?t[0]:null)})})},x=function(e){return new Promise(t=>{chrome.tabs.sendMessage(e,{type:"getQuickAddData"},u=>{if(chrome.runtime.lastError){t(null);return}t(u||null)})})},W=function(e){Q.classList.toggle("hidden",!e),V.classList.toggle("hidden",e),document.body.classList.toggle("not-youtube",!e)},z=function(){chrome.tabs?.query&&chrome.tabs.query({active:!0,currentWindow:!0},e=>{let t=e&&e[0]?e[0]:null,u=t?.url||t?.pendingUrl||"";W(T(u))})},b=function(e,t="success"){m.textContent=e,m.classList.remove("success","error","warning"),e?m.classList.add("show",t):m.classList.remove("show"),e&&(B&&window.clearTimeout(B),B=window.setTimeout(()=>{m.textContent="",m.classList.remove("show")},1500))},$=function(){document.body.classList.toggle("is-debug",!1),U.classList.toggle("hidden",!0);let t=document.querySelector(".bottom-bar");t instanceof HTMLElement&&t.classList.toggle("no-debug",!0)},G=function(e){let t=X(a);chrome.storage.sync.set({rules:t},()=>{a=t,f(),e&&b("Saved","success")})},w=function(e=!0){L&&window.clearTimeout(L),L=window.setTimeout(()=>{L=null,G(e)},500)},f=function(){if(c.innerHTML="",a.length===0){let e=document.createElement("div");e.className="hint",e.textContent="No rules yet. Add one below.",c.appendChild(e);return}a.forEach((e,t)=>{let u=document.createElement("div");u.className="row",u.dataset.index=String(t);let o=document.createElement("div");o.className="order";let n=document.createElement("span");n.className="index",n.textContent=String(t+1);let s=document.createElement("button");s.type="button",s.className="icon-btn small drag-handle",s.textContent="\u2261",s.title="Drag to reorder",s.draggable=!1,o.append(n,s);let S=document.createElement("select");S.dataset.field="type",["channel","videoId","title"].forEach(R=>{let I=document.createElement("option");I.value=R,I.textContent=v[R],e.type===R&&(I.selected=!0),S.appendChild(I)});let g=document.createElement("input");g.type="text",g.value=e.value,g.placeholder="Match text",g.dataset.field="value";let d=document.createElement("input");d.type="number",d.min="0.25",d.max="4",d.step="0.25",d.value=e.speed,d.placeholder="1.5",d.dataset.field="speed";let A=document.createElement("div");A.className="actions-inline";let h=document.createElement("button");h.type="button",h.className="icon-btn danger",h.textContent="Delete",h.dataset.action="delete",A.append(h),u.append(o,S,g,d,A),c.appendChild(u)})},X=function(e){return e.map(t=>({id:t.id||crypto.randomUUID(),type:t.type,value:String(t.value||"").trim(),speed:String(t.speed||"").trim()})).filter(t=>t.value&&t.speed)},F=function(e,t){if(t<0||t>=a.length)return;let u=[...a],[o]=u.splice(e,1);u.splice(t,0,o),a=u,f(),w()},J=function(e){a=a.filter((t,u)=>u!==e),f(),w(!1),b("Deleted","error")},K=function(e,t,u){a=a.map((o,n)=>n!==e?o:{...o,[t]:u}),w()},Z=function(e){return e.closest(".drag-handle")?!1:!!e.closest("input, select, textarea, button")},ee=function(e,t){p=Number(e.dataset.index),i=t,l=e,r=l.cloneNode(!0),r.classList.add("drag-placeholder"),r.removeAttribute("data-index"),r.setAttribute("aria-hidden","true"),l.style.display="none",c.insertBefore(r,l),document.body.classList.add("no-select")},te=function(e,t){if(!r)return;let u=Array.from(c.querySelectorAll(".row")).filter(n=>n!==r&&n!==l);if(u.length===0){c.appendChild(r);return}let o=u.find(n=>{let s=n.getBoundingClientRect();return t<s.top+s.height/2});o?o.insertAdjacentElement("beforebegin",r):u[u.length-1].insertAdjacentElement("afterend",r)},ue=function(e){let t=c.getBoundingClientRect(),u=24,o=12;if(e<t.top+u){let n=Math.max(0,t.top+u-e);c.scrollTop-=Math.min(o,n);return}if(e>t.bottom-u){let n=Math.max(0,e-(t.bottom-u));c.scrollTop+=Math.min(o,n)}},oe=function(){if(p!==null){if(r){let e=Array.from(c.children),t=0;for(let u of e){if(u===r)break;u.classList.contains("row")&&u!==l&&u!==r&&(t+=1)}p!==t&&F(p,t)}Y()}},Y=function(){r&&r.parentElement&&r.parentElement.removeChild(r),l&&(l.style.display=""),p=null,r=null,l=null,i=null,document.body.classList.remove("no-select")},H={rules:[]},v={channel:"Channel",title:"Title",videoId:"Video ID"},a=[],p=null,r=null,l=null,i=null,L=null,B=null;async function N(){let e=await C();if(!e||!T(e.url||e.pendingUrl||"")){M.disabled=!0,D.disabled=!0;return}let t=e.id?await x(e.id):null,u=t?.videoId||_(e.url||e.pendingUrl||""),o=q(t?.channelCandidates||[]);D.disabled=!u,M.disabled=!o}c.addEventListener("click",e=>{let t=e.target;if(!(t instanceof HTMLElement))return;let u=t.closest(".row");if(!(u instanceof HTMLElement))return;let o=Number(u.dataset.index);t.dataset.action==="delete"&&J(o)}),c.addEventListener("pointerdown",e=>{if(e.button!==0)return;let t=e.target;if(!(t instanceof HTMLElement)||Z(t))return;let u=t.closest(".row");u instanceof HTMLDivElement&&(ee(u,e.pointerId),e.target.setPointerCapture(e.pointerId))}),c.addEventListener("pointermove",e=>{i===null||e.pointerId!==i||(ue(e.clientY),te(e.clientX,e.clientY))}),c.addEventListener("pointerup",e=>{i===null||e.pointerId!==i||oe()}),c.addEventListener("pointercancel",e=>{i===null||e.pointerId!==i||Y()}),c.addEventListener("input",e=>{let t=e.target;if(!(t instanceof HTMLInputElement||t instanceof HTMLSelectElement))return;let u=t.closest(".row");if(!(u instanceof HTMLElement))return;let o=Number(u.dataset.index),n=t.dataset.field;n&&K(o,n,t.value)}),O.addEventListener("click",()=>{let e=E.value.trim(),t=y.value.trim();if(!e||!t){b("Add a match and speed","warning");return}a=[...a,{id:crypto.randomUUID(),type:k.value,value:e,speed:t}],E.value="",y.value="",f(),w()}),M.addEventListener("click",async()=>{let e=await C(),t=e?.url||e?.pendingUrl||"";if(!e||!T(t)){b("Open a YouTube tab","warning");return}let u=e.id?await x(e.id):null,o=q(u?.channelCandidates||[]);if(!o){b("Channel not found","error");return}k.value="channel",E.value=o,y.focus(),y.select()}),D.addEventListener("click",async()=>{let e=await C(),t=e?.url||e?.pendingUrl||"";if(!e||!T(t)){b("Open a YouTube tab","warning");return}let o=(e.id?await x(e.id):null)?.videoId||_(t);if(!o){b("Video ID not found","error");return}k.value="videoId",E.value=o,y.focus(),y.select()}),chrome.storage.sync.get(H,e=>{a=e.rules||[],f(),z(),N(),$()}),z(),N()}})();
