(()=>{var Y=["youtu.be","youtube-nocookie.com","youtube.ae","youtube.al","youtube.am","youtube.at","youtube.az","youtube.ba","youtube.be","youtube.bg","youtube.bh","youtube.bo","youtube.by","youtube.ca","youtube.cat","youtube.ch","youtube.cl","youtube.co","youtube.co.ae","youtube.co.at","youtube.co.cr","youtube.co.hu","youtube.co.id","youtube.co.il","youtube.co.in","youtube.co.jp","youtube.co.ke","youtube.co.kr","youtube.co.ma","youtube.co.nz","youtube.co.th","youtube.co.tz","youtube.co.ug","youtube.co.uk","youtube.co.ve","youtube.co.za","youtube.co.zw","youtube.com","youtube.com.ar","youtube.com.au","youtube.com.az","youtube.com.bd","youtube.com.bh","youtube.com.bo","youtube.com.br","youtube.com.by","youtube.com.co","youtube.com.do","youtube.com.ec","youtube.com.ee","youtube.com.eg","youtube.com.es","youtube.com.gh","youtube.com.gr","youtube.com.gt","youtube.com.hk","youtube.com.hn","youtube.com.hr","youtube.com.jm","youtube.com.jo","youtube.com.kw","youtube.com.lb","youtube.com.lv","youtube.com.ly","youtube.com.mk","youtube.com.mt","youtube.com.mx","youtube.com.my","youtube.com.ng","youtube.com.ni","youtube.com.om","youtube.com.pa","youtube.com.pe","youtube.com.ph","youtube.com.pk","youtube.com.pt","youtube.com.py","youtube.com.qa","youtube.com.ro","youtube.com.sa","youtube.com.sg","youtube.com.sv","youtube.com.tn","youtube.com.tr","youtube.com.tw","youtube.com.ua","youtube.com.uy","youtube.com.ve","youtube.cr","youtube.cz","youtube.de","youtube.dk","youtube.ee","youtube.es","youtube.fi","youtube.fr","youtube.ge","youtube.gr","youtube.gt","youtube.hk","youtube.hr","youtube.hu","youtube.ie","youtube.in","youtube.iq","youtube.is","youtube.it","youtube.jo","youtube.jp","youtube.kr","youtube.kz","youtube.la","youtube.lk","youtube.lt","youtube.lu","youtube.lv","youtube.ly","youtube.ma","youtube.md","youtube.me","youtube.mk","youtube.mn","youtube.mx","youtube.my","youtube.ng","youtube.ni","youtube.nl","youtube.no","youtube.pa","youtube.pe","youtube.ph","youtube.pk","youtube.pl","youtube.pr","youtube.pt","youtube.qa","youtube.ro","youtube.rs","youtube.ru","youtube.sa","youtube.se","youtube.sg","youtube.si","youtube.sk","youtube.sn","youtube.soy","youtube.sv","youtube.tn","youtube.tv","youtube.ua","youtube.ug","youtube.uy","youtube.vn","youtubeeducation.com","youtubefanfest.com","youtubegaming.com","youtubego.co.id","youtubego.co.in","youtubego.com","youtubego.com.br","youtubego.id","youtubego.in","youtubekids.com","youtubemobilesupport.com","yt.be"],te=new Set(Y);function j(H){let E=H.toLowerCase();if(te.has(E))return!0;for(let a of Y)if(E.endsWith(`.${a}`))return!0;return!1}var l=document.getElementById("rulesBody"),R=document.getElementById("status"),P=document.getElementById("addRule"),w=document.getElementById("quickAddChannel"),M=document.getElementById("quickAddVideo"),k=document.getElementById("newType"),h=document.getElementById("newValue"),b=document.getElementById("newSpeed"),S=document.getElementById("debugInfo"),O=document.getElementById("editor"),Q=document.getElementById("notYoutube");if(!l||!R||!P||!w||!M||!k||!h||!b||!S||!O||!Q)console.warn("TooMuchYouTube popup: missing required elements.");else{let T=function(e){if(!e)return!1;try{let t=new URL(e);return j(t.hostname)}catch{return!1}},U=function(e){if(!e)return"";try{let t=new URL(e);if(t.hostname==="youtu.be")return t.pathname.split("/")[1]?.split(/[?&#/]/)[0]||"";let u=t.searchParams.get("v");return u||t.pathname.startsWith("/shorts/")&&t.pathname.split("/shorts/")[1].split(/[?&#/]/)[0]||""}catch{return""}},_=function(e){let t=e.map(o=>o.trim()).filter(Boolean),u=t.find(o=>o.startsWith("@"));if(u)return u;let n=t.find(o=>/^UC[\w-]{10,}$/.test(o));return n||t[0]||""},B=function(){return new Promise(e=>{chrome.tabs.query({active:!0,currentWindow:!0},t=>{e(t&&t[0]?t[0]:null)})})},D=function(e){return new Promise(t=>{chrome.tabs.sendMessage(e,{type:"getQuickAddData"},u=>{if(chrome.runtime.lastError){t(null);return}t(u||null)})})},V=function(e){O.classList.toggle("hidden",!e),Q.classList.toggle("hidden",e),document.body.classList.toggle("not-youtube",!e)},q=function(){chrome.tabs?.query&&chrome.tabs.query({active:!0,currentWindow:!0},e=>{let t=e&&e[0]?e[0]:null,u=t?.url||t?.pendingUrl||"";V(T(u))})},y=function(e){R.textContent=e,e&&setTimeout(()=>{R.textContent=""},1500)},ue=function(){},W=function(){let e=$(a);chrome.storage.sync.set({rules:e},()=>{a=e,p(),y("Saved")})},L=function(){v&&window.clearTimeout(v),v=window.setTimeout(()=>{v=null,W()},500)},p=function(){if(l.innerHTML="",a.length===0){let e=document.createElement("div");e.className="hint",e.textContent="No rules yet. Add one below.",l.appendChild(e);return}a.forEach((e,t)=>{let u=document.createElement("div");u.className="row",u.dataset.index=String(t);let n=document.createElement("div");n.className="order";let o=document.createElement("span");o.className="index",o.textContent=String(t+1);let i=document.createElement("button");i.type="button",i.className="icon-btn small drag-handle",i.textContent="\u2261",i.title="Drag to reorder",i.draggable=!1,n.append(o,i);let C=document.createElement("select");C.dataset.field="type",["channel","videoId","title"].forEach(A=>{let I=document.createElement("option");I.value=A,I.textContent=E[A],e.type===A&&(I.selected=!0),C.appendChild(I)});let f=document.createElement("input");f.type="text",f.value=e.value,f.placeholder="Match text",f.dataset.field="value";let d=document.createElement("input");d.type="number",d.min="0.25",d.max="4",d.step="0.25",d.value=e.speed,d.placeholder="1.5",d.dataset.field="speed";let x=document.createElement("div");x.className="actions-inline";let g=document.createElement("button");g.type="button",g.className="icon-btn danger",g.textContent="Delete",g.dataset.action="delete",x.append(g),u.append(n,C,f,d,x),l.appendChild(u)})},$=function(e){return e.map(t=>({id:t.id||crypto.randomUUID(),type:t.type,value:String(t.value||"").trim(),speed:String(t.speed||"").trim()})).filter(t=>t.value&&t.speed)},G=function(e,t){if(t<0||t>=a.length)return;let u=[...a],[n]=u.splice(e,1);u.splice(t,0,n),a=u,p(),L()},X=function(e){a=a.filter((t,u)=>u!==e),p(),L()},F=function(e,t,u){a=a.map((n,o)=>o!==e?n:{...n,[t]:u}),L()},J=function(e){return e.closest(".drag-handle")?!1:!!e.closest("input, select, textarea, button")},K=function(e,t){m=Number(e.dataset.index),s=t,c=e,r=c.cloneNode(!0),r.classList.add("drag-placeholder"),r.removeAttribute("data-index"),r.setAttribute("aria-hidden","true"),c.style.display="none",l.insertBefore(r,c),document.body.classList.add("no-select")},Z=function(e,t){if(!r)return;let u=Array.from(l.querySelectorAll(".row")).filter(o=>o!==r&&o!==c);if(u.length===0){l.appendChild(r);return}let n=u.find(o=>{let i=o.getBoundingClientRect();return t<i.top+i.height/2});n?n.insertAdjacentElement("beforebegin",r):u[u.length-1].insertAdjacentElement("afterend",r)},ee=function(){if(m!==null){if(r){let e=Array.from(l.children),t=0;for(let u of e){if(u===r)break;u.classList.contains("row")&&u!==c&&u!==r&&(t+=1)}m!==t&&G(m,t)}z()}},z=function(){r&&r.parentElement&&r.parentElement.removeChild(r),c&&(c.style.display=""),m=null,r=null,c=null,s=null,document.body.classList.remove("no-select")},H={rules:[]},E={channel:"Channel",title:"Title",videoId:"Video ID"},a=[],m=null,r=null,c=null,s=null,v=null;async function N(){let e=await B();if(!e||!T(e.url||e.pendingUrl||"")){w.disabled=!0,M.disabled=!0;return}let t=e.id?await D(e.id):null,u=t?.videoId||U(e.url||e.pendingUrl||""),n=_(t?.channelCandidates||[]);M.disabled=!u,w.disabled=!n}l.addEventListener("click",e=>{let t=e.target;if(!(t instanceof HTMLElement))return;let u=t.closest(".row");if(!(u instanceof HTMLElement))return;let n=Number(u.dataset.index);t.dataset.action==="delete"&&X(n)}),l.addEventListener("pointerdown",e=>{if(e.button!==0)return;let t=e.target;if(!(t instanceof HTMLElement)||J(t))return;let u=t.closest(".row");u instanceof HTMLDivElement&&(K(u,e.pointerId),e.target.setPointerCapture(e.pointerId))}),l.addEventListener("pointermove",e=>{s===null||e.pointerId!==s||Z(e.clientX,e.clientY)}),l.addEventListener("pointerup",e=>{s===null||e.pointerId!==s||ee()}),l.addEventListener("pointercancel",e=>{s===null||e.pointerId!==s||z()}),l.addEventListener("input",e=>{let t=e.target;if(!(t instanceof HTMLInputElement||t instanceof HTMLSelectElement))return;let u=t.closest(".row");if(!(u instanceof HTMLElement))return;let n=Number(u.dataset.index),o=t.dataset.field;o&&F(n,o,t.value)}),P.addEventListener("click",()=>{let e=h.value.trim(),t=b.value.trim();if(!e||!t){y("Add a match and speed");return}a=[...a,{id:crypto.randomUUID(),type:k.value,value:e,speed:t}],h.value="",b.value="",p(),L()}),w.addEventListener("click",async()=>{let e=await B(),t=e?.url||e?.pendingUrl||"";if(!e||!T(t)){y("Open a YouTube tab");return}let u=e.id?await D(e.id):null,n=_(u?.channelCandidates||[]);if(!n){y("Channel not found");return}k.value="channel",h.value=n,b.focus(),b.select()}),M.addEventListener("click",async()=>{let e=await B(),t=e?.url||e?.pendingUrl||"";if(!e||!T(t)){y("Open a YouTube tab");return}let n=(e.id?await D(e.id):null)?.videoId||U(t);if(!n){y("Video ID not found");return}k.value="videoId",h.value=n,b.focus(),b.select()}),chrome.storage.sync.get(H,e=>{a=e.rules||[],p(),q(),N()}),q(),N()}})();
