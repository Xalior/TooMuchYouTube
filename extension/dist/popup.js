(()=>{var A=["youtu.be","youtube-nocookie.com","youtube.ae","youtube.al","youtube.am","youtube.at","youtube.az","youtube.ba","youtube.be","youtube.bg","youtube.bh","youtube.bo","youtube.by","youtube.ca","youtube.cat","youtube.ch","youtube.cl","youtube.co","youtube.co.ae","youtube.co.at","youtube.co.cr","youtube.co.hu","youtube.co.id","youtube.co.il","youtube.co.in","youtube.co.jp","youtube.co.ke","youtube.co.kr","youtube.co.ma","youtube.co.nz","youtube.co.th","youtube.co.tz","youtube.co.ug","youtube.co.uk","youtube.co.ve","youtube.co.za","youtube.co.zw","youtube.com","youtube.com.ar","youtube.com.au","youtube.com.az","youtube.com.bd","youtube.com.bh","youtube.com.bo","youtube.com.br","youtube.com.by","youtube.com.co","youtube.com.do","youtube.com.ec","youtube.com.ee","youtube.com.eg","youtube.com.es","youtube.com.gh","youtube.com.gr","youtube.com.gt","youtube.com.hk","youtube.com.hn","youtube.com.hr","youtube.com.jm","youtube.com.jo","youtube.com.kw","youtube.com.lb","youtube.com.lv","youtube.com.ly","youtube.com.mk","youtube.com.mt","youtube.com.mx","youtube.com.my","youtube.com.ng","youtube.com.ni","youtube.com.om","youtube.com.pa","youtube.com.pe","youtube.com.ph","youtube.com.pk","youtube.com.pt","youtube.com.py","youtube.com.qa","youtube.com.ro","youtube.com.sa","youtube.com.sg","youtube.com.sv","youtube.com.tn","youtube.com.tr","youtube.com.tw","youtube.com.ua","youtube.com.uy","youtube.com.ve","youtube.cr","youtube.cz","youtube.de","youtube.dk","youtube.ee","youtube.es","youtube.fi","youtube.fr","youtube.ge","youtube.gr","youtube.gt","youtube.hk","youtube.hr","youtube.hu","youtube.ie","youtube.in","youtube.iq","youtube.is","youtube.it","youtube.jo","youtube.jp","youtube.kr","youtube.kz","youtube.la","youtube.lk","youtube.lt","youtube.lu","youtube.lv","youtube.ly","youtube.ma","youtube.md","youtube.me","youtube.mk","youtube.mn","youtube.mx","youtube.my","youtube.ng","youtube.ni","youtube.nl","youtube.no","youtube.pa","youtube.pe","youtube.ph","youtube.pk","youtube.pl","youtube.pr","youtube.pt","youtube.qa","youtube.ro","youtube.rs","youtube.ru","youtube.sa","youtube.se","youtube.sg","youtube.si","youtube.sk","youtube.sn","youtube.soy","youtube.sv","youtube.tn","youtube.tv","youtube.ua","youtube.ug","youtube.uy","youtube.vn","youtubeeducation.com","youtubefanfest.com","youtubegaming.com","youtubego.co.id","youtubego.co.in","youtubego.com","youtubego.com.br","youtubego.id","youtubego.in","youtubekids.com","youtubemobilesupport.com","yt.be"],W=new Set(A);function D(w){let f=w.toLowerCase();if(W.has(f))return!0;for(let n of A)if(f.endsWith(`.${n}`))return!0;return!1}var d=document.getElementById("rulesBody"),M=document.getElementById("status"),N=document.getElementById("save"),q=document.getElementById("addRule"),v=document.getElementById("quickAddChannel"),E=document.getElementById("quickAddVideo"),T=document.getElementById("newType"),p=document.getElementById("newValue"),s=document.getElementById("newSpeed"),z=document.getElementById("editor"),Y=document.getElementById("notYoutube");if(!d||!M||!N||!q||!v||!E||!T||!p||!s||!z||!Y)console.warn("TooMuchYouTube popup: missing required elements.");else{let g=function(e){if(!e)return!1;try{let t=new URL(e);return D(t.hostname)}catch{return!1}},H=function(e){if(!e)return"";try{let t=new URL(e);if(t.hostname==="youtu.be")return t.pathname.split("/")[1]?.split(/[?&#/]/)[0]||"";let u=t.searchParams.get("v");return u||t.pathname.startsWith("/shorts/")&&t.pathname.split("/shorts/")[1].split(/[?&#/]/)[0]||""}catch{return""}},R=function(e){let t=e.map(c=>c.trim()).filter(Boolean),u=t.find(c=>c.startsWith("@"));if(u)return u;let o=t.find(c=>/^UC[\w-]{10,}$/.test(c));return o||t[0]||""},k=function(){return new Promise(e=>{chrome.tabs.query({active:!0,currentWindow:!0},t=>{e(t&&t[0]?t[0]:null)})})},I=function(e){return new Promise(t=>{chrome.tabs.sendMessage(e,{type:"getQuickAddData"},u=>{if(chrome.runtime.lastError){t(null);return}t(u||null)})})},V=function(e){z.classList.toggle("hidden",!e),Y.classList.toggle("hidden",e)},x=function(){chrome.tabs?.query&&chrome.tabs.query({active:!0,currentWindow:!0},e=>{let t=e&&e[0]?e[0]:null,u=t?.url||t?.pendingUrl||"";V(g(u))})},l=function(e){M.textContent=e,e&&setTimeout(()=>{M.textContent=""},1500)},b=function(){if(d.innerHTML="",n.length===0){let e=document.createElement("div");e.className="hint",e.textContent="No rules yet. Add one below.",d.appendChild(e);return}n.forEach((e,t)=>{let u=document.createElement("div");u.className="row",u.dataset.index=String(t);let o=document.createElement("div");o.className="order";let c=document.createElement("span");c.className="index",c.textContent=String(t+1);let r=document.createElement("button");r.type="button",r.className="icon-btn small",r.textContent="\u25B2",r.dataset.action="up",r.disabled=t===0;let i=document.createElement("button");i.type="button",i.className="icon-btn small",i.textContent="\u25BC",i.dataset.action="down",i.disabled=t===n.length-1,o.append(c,r,i);let L=document.createElement("select");L.dataset.field="type",["channel","videoId","title"].forEach(C=>{let h=document.createElement("option");h.value=C,h.textContent=f[C],e.type===C&&(h.selected=!0),L.appendChild(h)});let y=document.createElement("input");y.type="text",y.value=e.value,y.placeholder="Match text",y.dataset.field="value";let a=document.createElement("input");a.type="number",a.min="0.25",a.max="4",a.step="0.25",a.value=e.speed,a.placeholder="1.5",a.dataset.field="speed";let B=document.createElement("div");B.className="actions-inline";let m=document.createElement("button");m.type="button",m.className="icon-btn",m.textContent="Delete",m.dataset.action="delete",B.append(m),u.append(o,L,y,a,B),d.appendChild(u)})},Q=function(e){return e.map(t=>({id:t.id||crypto.randomUUID(),type:t.type,value:String(t.value||"").trim(),speed:String(t.speed||"").trim()})).filter(t=>t.value&&t.speed)},S=function(e,t){if(t<0||t>=n.length)return;let u=[...n],[o]=u.splice(e,1);u.splice(t,0,o),n=u,b()},j=function(e){n=n.filter((t,u)=>u!==e),b()},O=function(e,t,u){n=n.map((o,c)=>c!==e?o:{...o,[t]:u})},w={rules:[]},f={channel:"Channel",title:"Title",videoId:"Video ID"},n=[];async function U(){let e=await k();if(!e||!g(e.url||e.pendingUrl||"")){v.disabled=!0,E.disabled=!0;return}let t=e.id?await I(e.id):null,u=t?.videoId||H(e.url||e.pendingUrl||""),o=R(t?.channelCandidates||[]);E.disabled=!u,v.disabled=!o}d.addEventListener("click",e=>{let t=e.target;if(!(t instanceof HTMLElement))return;let u=t.closest(".row");if(!(u instanceof HTMLElement))return;let o=Number(u.dataset.index);t.dataset.action==="up"&&S(o,o-1),t.dataset.action==="down"&&S(o,o+1),t.dataset.action==="delete"&&j(o)}),d.addEventListener("input",e=>{let t=e.target;if(!(t instanceof HTMLInputElement||t instanceof HTMLSelectElement))return;let u=t.closest(".row");if(!(u instanceof HTMLElement))return;let o=Number(u.dataset.index),c=t.dataset.field;c&&O(o,c,t.value)}),q.addEventListener("click",()=>{let e=p.value.trim(),t=s.value.trim();if(!e||!t){l("Add a match and speed");return}n=[...n,{id:crypto.randomUUID(),type:T.value,value:e,speed:t}],p.value="",s.value="",b()}),v.addEventListener("click",async()=>{let e=await k(),t=e?.url||e?.pendingUrl||"";if(!e||!g(t)){l("Open a YouTube tab");return}let u=e.id?await I(e.id):null,o=R(u?.channelCandidates||[]);if(!o){l("Channel not found");return}T.value="channel",p.value=o,s.focus(),s.select()}),E.addEventListener("click",async()=>{let e=await k(),t=e?.url||e?.pendingUrl||"";if(!e||!g(t)){l("Open a YouTube tab");return}let o=(e.id?await I(e.id):null)?.videoId||H(t);if(!o){l("Video ID not found");return}T.value="videoId",p.value=o,s.focus(),s.select()}),N.addEventListener("click",()=>{let e=Q(n);chrome.storage.sync.set({rules:e},()=>{n=e,b(),l("Saved")})}),chrome.storage.sync.get(w,e=>{n=e.rules||[],b(),x(),U()}),x(),U()}})();
