(()=>{var D=["youtu.be","youtube-nocookie.com","youtube.ae","youtube.al","youtube.am","youtube.at","youtube.az","youtube.ba","youtube.be","youtube.bg","youtube.bh","youtube.bo","youtube.by","youtube.ca","youtube.cat","youtube.ch","youtube.cl","youtube.co","youtube.co.ae","youtube.co.at","youtube.co.cr","youtube.co.hu","youtube.co.id","youtube.co.il","youtube.co.in","youtube.co.jp","youtube.co.ke","youtube.co.kr","youtube.co.ma","youtube.co.nz","youtube.co.th","youtube.co.tz","youtube.co.ug","youtube.co.uk","youtube.co.ve","youtube.co.za","youtube.co.zw","youtube.com","youtube.com.ar","youtube.com.au","youtube.com.az","youtube.com.bd","youtube.com.bh","youtube.com.bo","youtube.com.br","youtube.com.by","youtube.com.co","youtube.com.do","youtube.com.ec","youtube.com.ee","youtube.com.eg","youtube.com.es","youtube.com.gh","youtube.com.gr","youtube.com.gt","youtube.com.hk","youtube.com.hn","youtube.com.hr","youtube.com.jm","youtube.com.jo","youtube.com.kw","youtube.com.lb","youtube.com.lv","youtube.com.ly","youtube.com.mk","youtube.com.mt","youtube.com.mx","youtube.com.my","youtube.com.ng","youtube.com.ni","youtube.com.om","youtube.com.pa","youtube.com.pe","youtube.com.ph","youtube.com.pk","youtube.com.pt","youtube.com.py","youtube.com.qa","youtube.com.ro","youtube.com.sa","youtube.com.sg","youtube.com.sv","youtube.com.tn","youtube.com.tr","youtube.com.tw","youtube.com.ua","youtube.com.uy","youtube.com.ve","youtube.cr","youtube.cz","youtube.de","youtube.dk","youtube.ee","youtube.es","youtube.fi","youtube.fr","youtube.ge","youtube.gr","youtube.gt","youtube.hk","youtube.hr","youtube.hu","youtube.ie","youtube.in","youtube.iq","youtube.is","youtube.it","youtube.jo","youtube.jp","youtube.kr","youtube.kz","youtube.la","youtube.lk","youtube.lt","youtube.lu","youtube.lv","youtube.ly","youtube.ma","youtube.md","youtube.me","youtube.mk","youtube.mn","youtube.mx","youtube.my","youtube.ng","youtube.ni","youtube.nl","youtube.no","youtube.pa","youtube.pe","youtube.ph","youtube.pk","youtube.pl","youtube.pr","youtube.pt","youtube.qa","youtube.ro","youtube.rs","youtube.ru","youtube.sa","youtube.se","youtube.sg","youtube.si","youtube.sk","youtube.sn","youtube.soy","youtube.sv","youtube.tn","youtube.tv","youtube.ua","youtube.ug","youtube.uy","youtube.vn","youtubeeducation.com","youtubefanfest.com","youtubegaming.com","youtubego.co.id","youtubego.co.in","youtubego.com","youtubego.com.br","youtubego.id","youtubego.in","youtubekids.com","youtubemobilesupport.com","yt.be"],_=new Set(D);function N(k){let p=k.toLowerCase();if(_.has(p))return!0;for(let n of D)if(p.endsWith(`.${n}`))return!0;return!1}var r=document.getElementById("rulesBody"),R=document.getElementById("status"),q=document.getElementById("addRule"),T=document.getElementById("quickAddChannel"),w=document.getElementById("quickAddVideo"),L=document.getElementById("newType"),f=document.getElementById("newValue"),l=document.getElementById("newSpeed"),z=document.getElementById("editor"),Y=document.getElementById("notYoutube");if(!r||!R||!q||!T||!w||!L||!f||!l||!z||!Y)console.warn("TooMuchYouTube popup: missing required elements.");else{let h=function(e){if(!e)return!1;try{let t=new URL(e);return N(t.hostname)}catch{return!1}},S=function(e){if(!e)return"";try{let t=new URL(e);if(t.hostname==="youtu.be")return t.pathname.split("/")[1]?.split(/[?&#/]/)[0]||"";let u=t.searchParams.get("v");return u||t.pathname.startsWith("/shorts/")&&t.pathname.split("/shorts/")[1].split(/[?&#/]/)[0]||""}catch{return""}},A=function(e){let t=e.map(a=>a.trim()).filter(Boolean),u=t.find(a=>a.startsWith("@"));if(u)return u;let o=t.find(a=>/^UC[\w-]{10,}$/.test(a));return o||t[0]||""},I=function(){return new Promise(e=>{chrome.tabs.query({active:!0,currentWindow:!0},t=>{e(t&&t[0]?t[0]:null)})})},M=function(e){return new Promise(t=>{chrome.tabs.sendMessage(e,{type:"getQuickAddData"},u=>{if(chrome.runtime.lastError){t(null);return}t(u||null)})})},V=function(e){z.classList.toggle("hidden",!e),Y.classList.toggle("hidden",e)},U=function(){chrome.tabs?.query&&chrome.tabs.query({active:!0,currentWindow:!0},e=>{let t=e&&e[0]?e[0]:null,u=t?.url||t?.pendingUrl||"";V(h(u))})},i=function(e){R.textContent=e,e&&setTimeout(()=>{R.textContent=""},1500)},Q=function(){let e=j(n);chrome.storage.sync.set({rules:e},()=>{n=e,d(),i("Saved")})},v=function(){g&&window.clearTimeout(g),g=window.setTimeout(()=>{g=null,Q()},500)},d=function(){if(r.innerHTML="",n.length===0){let e=document.createElement("div");e.className="hint",e.textContent="No rules yet. Add one below.",r.appendChild(e);return}n.forEach((e,t)=>{let u=document.createElement("div");u.className="row",u.dataset.index=String(t);let o=document.createElement("div");o.className="order";let a=document.createElement("span");a.className="index",a.textContent=String(t+1);let b=document.createElement("button");b.type="button",b.className="icon-btn small drag-handle",b.textContent="\u2261",b.title="Drag to reorder",o.append(a,b);let H=document.createElement("select");H.dataset.field="type",["channel","videoId","title"].forEach(C=>{let E=document.createElement("option");E.value=C,E.textContent=p[C],e.type===C&&(E.selected=!0),H.appendChild(E)});let y=document.createElement("input");y.type="text",y.value=e.value,y.placeholder="Match text",y.dataset.field="value";let c=document.createElement("input");c.type="number",c.min="0.25",c.max="4",c.step="0.25",c.value=e.speed,c.placeholder="1.5",c.dataset.field="speed";let x=document.createElement("div");x.className="actions-inline";let m=document.createElement("button");m.type="button",m.className="icon-btn danger",m.textContent="Delete",m.dataset.action="delete",x.append(m),u.setAttribute("draggable","true"),u.append(o,H,y,c,x),r.appendChild(u)})},j=function(e){return e.map(t=>({id:t.id||crypto.randomUUID(),type:t.type,value:String(t.value||"").trim(),speed:String(t.speed||"").trim()})).filter(t=>t.value&&t.speed)},O=function(e,t){if(t<0||t>=n.length)return;let u=[...n],[o]=u.splice(e,1);u.splice(t,0,o),n=u,d(),v()},W=function(e){n=n.filter((t,u)=>u!==e),d(),v()},P=function(e,t,u){n=n.map((o,a)=>a!==e?o:{...o,[t]:u}),v()},k={rules:[]},p={channel:"Channel",title:"Title",videoId:"Video ID"},n=[],s=null,g=null;async function B(){let e=await I();if(!e||!h(e.url||e.pendingUrl||"")){T.disabled=!0,w.disabled=!0;return}let t=e.id?await M(e.id):null,u=t?.videoId||S(e.url||e.pendingUrl||""),o=A(t?.channelCandidates||[]);w.disabled=!u,T.disabled=!o}r.addEventListener("click",e=>{let t=e.target;if(!(t instanceof HTMLElement))return;let u=t.closest(".row");if(!(u instanceof HTMLElement))return;let o=Number(u.dataset.index);t.dataset.action==="delete"&&W(o)}),r.addEventListener("dragstart",e=>{let t=e.target;if(!(t instanceof HTMLElement)||!t.closest(".drag-handle"))return;let u=t.closest(".row");u instanceof HTMLElement&&(s=Number(u.dataset.index),u.classList.add("dragging"),e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",String(s))))}),r.addEventListener("dragend",()=>{s=null,document.querySelectorAll(".row.dragging, .row.drag-over").forEach(e=>{e.classList.remove("dragging","drag-over")})}),r.addEventListener("dragover",e=>{let t=e.target;if(!(t instanceof HTMLElement))return;let u=t.closest(".row");u instanceof HTMLElement&&(e.preventDefault(),u.classList.add("drag-over"),e.dataTransfer&&(e.dataTransfer.dropEffect="move"))}),r.addEventListener("dragleave",e=>{let t=e.target;if(!(t instanceof HTMLElement))return;let u=t.closest(".row");u instanceof HTMLElement&&u.classList.remove("drag-over")}),r.addEventListener("drop",e=>{let t=e.target;if(!(t instanceof HTMLElement))return;let u=t.closest(".row");if(!(u instanceof HTMLElement))return;e.preventDefault(),u.classList.remove("drag-over");let o=Number(u.dataset.index);s===null||Number.isNaN(o)||(s!==o&&O(s,o),s=null)}),r.addEventListener("input",e=>{let t=e.target;if(!(t instanceof HTMLInputElement||t instanceof HTMLSelectElement))return;let u=t.closest(".row");if(!(u instanceof HTMLElement))return;let o=Number(u.dataset.index),a=t.dataset.field;a&&P(o,a,t.value)}),q.addEventListener("click",()=>{let e=f.value.trim(),t=l.value.trim();if(!e||!t){i("Add a match and speed");return}n=[...n,{id:crypto.randomUUID(),type:L.value,value:e,speed:t}],f.value="",l.value="",d(),v()}),T.addEventListener("click",async()=>{let e=await I(),t=e?.url||e?.pendingUrl||"";if(!e||!h(t)){i("Open a YouTube tab");return}let u=e.id?await M(e.id):null,o=A(u?.channelCandidates||[]);if(!o){i("Channel not found");return}L.value="channel",f.value=o,l.focus(),l.select()}),w.addEventListener("click",async()=>{let e=await I(),t=e?.url||e?.pendingUrl||"";if(!e||!h(t)){i("Open a YouTube tab");return}let o=(e.id?await M(e.id):null)?.videoId||S(t);if(!o){i("Video ID not found");return}L.value="videoId",f.value=o,l.focus(),l.select()}),chrome.storage.sync.get(k,e=>{n=e.rules||[],d(),U(),B()}),U(),B()}})();
